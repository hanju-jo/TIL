<!DOCTYPE HTML>
<html lang="ko" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Deploying Django Project On Ubuntu Using Nginx And Gunicorn - Hanju's TIL Book</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">README</a></li><li class="chapter-item "><a href="../data-visualization/index.html"><strong aria-hidden="true">1.</strong> Data Visualization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../data-visualization/d3.js-tutorial.html"><strong aria-hidden="true">1.1.</strong> D3.js Tutorial</a></li></ol></li><li class="chapter-item "><a href="../database/index.html"><strong aria-hidden="true">2.</strong> Database</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../database/mongodb-setup.html"><strong aria-hidden="true">2.1.</strong> Mongodb Setup</a></li><li class="chapter-item "><a href="../database/postgresql-on-ubuntu.html"><strong aria-hidden="true">2.2.</strong> Postgresql On Ubuntu</a></li></ol></li><li class="chapter-item "><a href="../design-patterns/index.html"><strong aria-hidden="true">3.</strong> Design Patterns</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../design-patterns/abstract-factory.html"><strong aria-hidden="true">3.1.</strong> Abstract Factory</a></li><li class="chapter-item "><a href="../design-patterns/adapter.html"><strong aria-hidden="true">3.2.</strong> Adapter</a></li><li class="chapter-item "><a href="../design-patterns/decorator.html"><strong aria-hidden="true">3.3.</strong> Decorator</a></li><li class="chapter-item "><a href="../design-patterns/delegation.html"><strong aria-hidden="true">3.4.</strong> Delegation</a></li><li class="chapter-item "><a href="../design-patterns/factory.html"><strong aria-hidden="true">3.5.</strong> Factory</a></li></ol></li><li class="chapter-item expanded "><a href="../django/index.html"><strong aria-hidden="true">4.</strong> Django</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../django/deploying-django-project-on-ubuntu-using-nginx-and-gunicorn.html" class="active"><strong aria-hidden="true">4.1.</strong> Deploying Django Project On Ubuntu Using Nginx And Gunicorn</a></li><li class="chapter-item "><a href="../django/django-bluebook.html"><strong aria-hidden="true">4.2.</strong> Django Bluebook</a></li><li class="chapter-item "><a href="../django/django-setup.html"><strong aria-hidden="true">4.3.</strong> Django Setup</a></li><li class="chapter-item "><a href="../django/django-with-postgresql-on-aws-ec2.html"><strong aria-hidden="true">4.4.</strong> Django With Postgresql On Aws Ec2</a></li><li class="chapter-item "><a href="../django/test-driven-development-with-python.html"><strong aria-hidden="true">4.5.</strong> Test Driven Development With Python</a></li></ol></li><li class="chapter-item "><a href="../docker/index.html"><strong aria-hidden="true">5.</strong> Docker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../docker/about-docker.html"><strong aria-hidden="true">5.1.</strong> About Docker</a></li><li class="chapter-item "><a href="../docker/docker-cheatsheet.html"><strong aria-hidden="true">5.2.</strong> Docker Cheatsheet</a></li><li class="chapter-item "><a href="../docker/docker-for-jekyll.html"><strong aria-hidden="true">5.3.</strong> Docker For Jekyll</a></li><li class="chapter-item "><a href="../docker/gollum-via-docker.html"><strong aria-hidden="true">5.4.</strong> Gollum Via Docker</a></li></ol></li><li class="chapter-item "><a href="../english/index.html"><strong aria-hidden="true">6.</strong> English</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../english/newly-learned-words-or-phrases.html"><strong aria-hidden="true">6.1.</strong> Newly Learned Words Or Phrases</a></li></ol></li><li class="chapter-item "><a href="../git/index.html"><strong aria-hidden="true">7.</strong> Git</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../git/git-cheat-sheet.html"><strong aria-hidden="true">7.1.</strong> Git Cheat Sheet</a></li><li class="chapter-item "><a href="../git/steps-after-fork.html"><strong aria-hidden="true">7.2.</strong> Steps After Fork</a></li></ol></li><li class="chapter-item "><a href="../jekyll/index.html"><strong aria-hidden="true">8.</strong> Jekyll</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../jekyll/add-disqus-to-jekyll.html"><strong aria-hidden="true">8.1.</strong> Add Disqus To Jekyll</a></li><li class="chapter-item "><a href="../jekyll/jekyll-with-google-analytics.html"><strong aria-hidden="true">8.2.</strong> Jekyll With Google Analytics</a></li></ol></li><li class="chapter-item "><a href="../ml/index.html"><strong aria-hidden="true">9.</strong> Ml</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ml/ml-study-notes.html"><strong aria-hidden="true">9.1.</strong> Ml Study Notes</a></li></ol></li><li class="chapter-item "><a href="../python/index.html"><strong aria-hidden="true">10.</strong> Python</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../python/effective-python.html"><strong aria-hidden="true">10.1.</strong> Effective Python</a></li><li class="chapter-item "><a href="../python/fundamental-python.html"><strong aria-hidden="true">10.2.</strong> Fundamental Python</a></li><li class="chapter-item "><a href="../python/python-react-setup.html"><strong aria-hidden="true">10.3.</strong> Python React Setup</a></li><li class="chapter-item "><a href="../python/python-tips.html"><strong aria-hidden="true">10.4.</strong> Python Tips</a></li><li class="chapter-item "><a href="../python/python-virtualenv.html"><strong aria-hidden="true">10.5.</strong> Python Virtualenv</a></li><li class="chapter-item "><a href="../python/transforming-code-into-beautiful-idiomatic-python.html"><strong aria-hidden="true">10.6.</strong> Transforming Code Into Beautiful Idiomatic Python</a></li></ol></li><li class="chapter-item "><a href="../reactjs/index.html"><strong aria-hidden="true">11.</strong> Reactjs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reactjs/reactjs-setup.html"><strong aria-hidden="true">11.1.</strong> Reactjs Setup</a></li></ol></li><li class="chapter-item "><a href="../sicp/index.html"><strong aria-hidden="true">12.</strong> Sicp</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sicp/1_02.html"><strong aria-hidden="true">12.1.</strong> 1_02</a></li><li class="chapter-item "><a href="../sicp/1_03.html"><strong aria-hidden="true">12.2.</strong> 1_03</a></li><li class="chapter-item "><a href="../sicp/1_05.html"><strong aria-hidden="true">12.3.</strong> 1_05</a></li><li class="chapter-item "><a href="../sicp/1_06.html"><strong aria-hidden="true">12.4.</strong> 1_06</a></li><li class="chapter-item "><a href="../sicp/1_07.html"><strong aria-hidden="true">12.5.</strong> 1_07</a></li><li class="chapter-item "><a href="../sicp/1_08.html"><strong aria-hidden="true">12.6.</strong> 1_08</a></li><li class="chapter-item "><a href="../sicp/1_09.html"><strong aria-hidden="true">12.7.</strong> 1_09</a></li><li class="chapter-item "><a href="../sicp/1_10.html"><strong aria-hidden="true">12.8.</strong> 1_10</a></li><li class="chapter-item "><a href="../sicp/racket.html"><strong aria-hidden="true">12.9.</strong> Racket</a></li></ol></li><li class="chapter-item "><a href="../snippets/index.html"><strong aria-hidden="true">13.</strong> Snippets</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../snippets/c++.html"><strong aria-hidden="true">13.1.</strong> C++</a></li></ol></li><li class="chapter-item "><a href="../uncategorized/index.html"><strong aria-hidden="true">14.</strong> Uncategorized</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../uncategorized/dotfiles.html"><strong aria-hidden="true">14.1.</strong> Dotfiles</a></li><li class="chapter-item "><a href="../uncategorized/hmac.html"><strong aria-hidden="true">14.2.</strong> Hmac</a></li><li class="chapter-item "><a href="../uncategorized/unix-command-tips.html"><strong aria-hidden="true">14.3.</strong> Unix Command Tips</a></li></ol></li><li class="chapter-item "><a href="../vim/index.html"><strong aria-hidden="true">15.</strong> Vim</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../vim/plugin-manager-vim-plug.html"><strong aria-hidden="true">15.1.</strong> Plugin Manager Vim Plug</a></li><li class="chapter-item "><a href="../vim/plugin-manager-vundle.html"><strong aria-hidden="true">15.2.</strong> Plugin Manager Vundle</a></li><li class="chapter-item "><a href="../vim/plugin-youcompleteme.html"><strong aria-hidden="true">15.3.</strong> Plugin Youcompleteme</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Hanju's TIL Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/hanju-jo/TIL" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#deploying-django-project-on-ubuntu-using-nginx-and-gunicorn" id="deploying-django-project-on-ubuntu-using-nginx-and-gunicorn">Deploying Django project on ubuntu using nginx and gunicorn</a></h1>
<p>이 글은 Django 프로젝트를 nginx와 gunicorn을 이용하여 ubuntu 서버에 배포하는 과정을 정리한 글이다. 도메인 구매도, vps 서버 구매도 모두 처음이었기 때문에 삽질을 많이 했다.</p>
<h2><a class="header" href="#서버-설정" id="서버-설정">서버 설정</a></h2>
<h3><a class="header" href="#1-서버-도메인-연결sup-classfootnote-referencea-href11asup" id="1-서버-도메인-연결sup-classfootnote-referencea-href11asup">1. 서버-도메인 연결<sup class="footnote-reference"><a href="#1">1</a></sup></a></h3>
<p>먼저 서버와 도메인을 구매한다. 서버는 <a href="https://blog.lael.be/post/44">국내 클라우드 서버호스팅 비교</a> 글 을 참고하여 <a href="https://www.conoha.jp/referral/?token=dKu6u1tdfEn8M0SX91iTgL9SB24ofA6k48Km5Kz.FoesM63ZRo4-5VI">ConoHa</a>에서 월 900엔짜리 서버를 사고,  도메인은 <a href="https://www.phps.kr/">PHPS</a>에서 샀다.</p>
<p>서버를 구매할 때 initial root password를 설정하고, ssh 파일도 다운받게 된다(물론 기존의 파일을 사용할 수도 있다). 초기에는 이 비밀번호와 ssh 파일을 통해 서버에 접속하게 되므로 잘 보관해 두는 것이 좋다.</p>
<p>도메인을 사고 나면 도메인과 내 서버의 아이피로 연결되는 과정이 필요한데, 이 역할을 하는 것이 DNS 서버이다. PHPS에서 도메인의 네임서버를 입력하는 칸이 있는데 이 부분에 ConoHa에서 제공하는 네임서버를 입력했다. 그리고 ConoHa의 DNS 설정에서 내 서버의 도메인을 추가한다. </p>
<h3><a class="header" href="#2-서버-접속" id="2-서버-접속">2. 서버 접속</a></h3>
<p>서버를 구매할 때 다운 받았던 (혹은 사용했던) ssh파일을 사용해서 서버에 접속한다. 파일 이름이 <code>my-ssh-key-file.pem</code> 이고 구매한 서버의 ip가 <code>***.**.**.***</code>이라면,</p>
<pre><code class="language-bash">$ chmod 400 my-ssh-key-file.pem # 권한 변경. 처음 한번만 하면 됨
$ ssh -i my-ssh-key-file.pem root@***.**.**.*** # root 계정으로 서버 접속
</code></pre>
<p>서버에 접속하고 나면 <code>$ date</code> 를 입력하여 시간이 잘 나오는지 확인해보자. 일본에 있는 서버이기 때문에 별도의 설정은 하지 않아도 된다.</p>
<h3><a class="header" href="#3-root-계정-암호-변경" id="3-root-계정-암호-변경">3. root 계정 암호 변경</a></h3>
<p>만약을 위해 root 계정의 암호를 변경한다.</p>
<pre><code class="language-bash">$ passwd
</code></pre>
<h3><a class="header" href="#4-서버-유저-추가" id="4-서버-유저-추가">4. 서버 유저 추가</a></h3>
<p>보안을 위해 서버의 계정을 새로 만들고, 앞으로는 그 계정을 사용하기로 한다. 새 계정의 아이디를 <code>my-user</code> 라고 하자.</p>
<pre><code class="language-bash">$ adduser my-user # 계정 생성
$ adduser my-user sudo # 관리자 권한 부여
$ login my-user # 로그인
</code></pre>
<h3><a class="header" href="#5-ssh-파일-생성-및-서버에-등록sup-classfootnote-referencea-href22asup" id="5-ssh-파일-생성-및-서버에-등록sup-classfootnote-referencea-href22asup">5. SSH 파일 생성 및 서버에 등록<sup class="footnote-reference"><a href="#2">2</a></sup></a></h3>
<p>앞서 ssh 파일로 서버에 접속할 때 root계정으로 로그인 했었다. 이제 <code>my-user</code> 계정을 사용하기로 했으므로 접속할 때부터 <code>my-user</code>로 로그인하기 위해 새로운 ssh키를 만든다. </p>
<p>먼저 클라이언트에서 <code>ssh-keygen</code> 명령어로 ssh 파일을 생성한다.</p>
<pre><code class="language-bash">$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa): new-ssh-key-file.pem # ssh 파일명
Enter passphrase (empty for no passphrase): # 최초 등록 시 사용할 비밀문구
Enter same passphrase again:
Your identification has been saved in new-ssh-key-file.pem.
Your public key has been saved in new-ssh-key-file.pem.pub.
</code></pre>
<p><code>new-ssh-key-file.pem</code>와 <code>new-ssh-key-file.pem.pub</code>이 생성된다. <code>*.pub</code>은 공개키인데, <code>cat</code>명령으로 공개키의 내용을 출력할 수 있다.</p>
<pre><code class="language-bash">$ cat new-ssh-key-file.pem.pub # 공개키 출력
</code></pre>
<p>그리고 서버에 공개키를 등록한다.</p>
<pre><code class="language-bash">$ mkdir ~/.ssh &amp;&amp; cd ~/.ssh 
$ cat &gt;&gt; authorized_keys
# 이 상태에서 클라이언트에서 출력했던 공개키를 복사 후 붙여넣은 다음, 줄을 바꾼후 Ctrl+d를 눌러 저장한다.
</code></pre>
<p>이렇게 하면 이제 서버에 접속할 때  <code>my-user</code>로 바로 로그인이 가능하다.</p>
<pre><code class="language-bash">$ ssh -i new-ssh-key-file.pem my-user@***.**.**.*** # my-user 계정으로 서버 접속
</code></pre>
<h3><a class="header" href="#6-root-계정-비활성화sup-classfootnote-referencea-href33asup" id="6-root-계정-비활성화sup-classfootnote-referencea-href33asup">6. root 계정 비활성화<sup class="footnote-reference"><a href="#3">3</a></sup></a></h3>
<p>보안을 위해 root 계정으로 로그인하지 못하도록 설정한다.</p>
<pre><code class="language-bash">$ sudo vim /etc/ssh/sshd_config
</code></pre>
<pre><code class="language-bash"># Authentication:
LoginGraceTime 120  
PermitRootLogin no # yes에서 no로 변경
</code></pre>
<p>해당 위치를 찾을때는 <code>/PermitRootLogin</code>를 입력하면 편리하다. 이제 root 계정으로는 서버에 접속할 수 없게 되었다.</p>
<p>변경사항들을 적용하려면 ssh 서비스를 재시작해야 한다.</p>
<pre><code class="language-bash">$ sudo service ssh restart
</code></pre>
<h3><a class="header" href="#7-방화벽-설정" id="7-방화벽-설정">7. 방화벽 설정</a></h3>
<p>우분투의 기본 방화벽인 ufw를 제공한다. 기본적으로 ufw는 disable로 설정되어 있다. 보안을 위해 방화벽을 설정한다.</p>
<pre><code class="language-bash">$ sudo ufw allow ssh
$ sudo ufw allow http
$ sudo ufw allow https
$ sudo ufw allow ftp
$ sudo ufw enable # 방화벽 설정
$ sudo ufw status # 방화벽 상태 확인
</code></pre>
<p>그리고 Brute-force에 대비하기 위해 <code>sshguard</code>를 설치한다. <code>sshguard</code>는 지정된 횟수만큼 접속 시도가 들어오면 방화벽에서 바로 차단한다.</p>
<pre><code class="language-bash">$ sudo apt-get install sshguard
$ sudo service sshguard start
</code></pre>
<h3><a class="header" href="#8-언어-설정" id="8-언어-설정">8. 언어 설정</a></h3>
<p>다음과 같은 경고를 계속 마주쳤다면, 언어를 설정해주도록 하자.</p>
<pre><code class="language-bash">perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LC_CTYPE = &quot;ko_KR.UTF-8&quot;,
	LANG = &quot;en_US.UTF-8&quot;
    are supported and installed on your system.
perl: warning: Falling back to a fallback locale (&quot;en_US.UTF-8&quot;).
locale: Cannot set LC_CTYPE to default locale: No such file or directory
locale: Cannot set LC_ALL to default locale: No such file or directory
</code></pre>
<pre><code class="language-bash">$ vim /etc/default/locale
LANG=&quot;en_US.UTF-8&quot;  
LANGUAGE=&quot;en_US.UTF-8&quot;  
LC_ALL=&quot;en_US.UTF-8&quot;  
</code></pre>
<h3><a class="header" href="#9-패키지-설치" id="9-패키지-설치">9. 패키지 설치</a></h3>
<pre><code class="language-bash">$ sudo apt-get update
$ sudo apt-get upgrade
$ sudo apt-get install zsh git
</code></pre>
<p>zsh와 oh-my-zsh를 사용한다면 다음을 입력하자.</p>
<pre><code class="language-bash">$ curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh # oh-my-zsh 설치
$ chsh -s $(which zsh) # 기본 셸을 zsh로 변경
</code></pre>
<p>여기까지 서버 설정이 끝났다. 이제 서버를 재부팅하고 프로젝트 설정으로 넘어간다.</p>
<pre><code class="language-bash">$ sudo reboot
</code></pre>
<h2><a class="header" href="#프로젝트-설정sup-classfootnote-referencea-href44asup" id="프로젝트-설정sup-classfootnote-referencea-href44asup">프로젝트 설정<sup class="footnote-reference"><a href="#4">4</a></sup></a></h2>
<p>프로젝트 전체 구조는 다음과 같다.</p>
<pre><code class="language-bash">.
└── projects
    └── myproject
        ├── config
        │   ├── gunicorn.service
        │   ├── myproject_nginx.conf
        │   └── myproject.sock
        ├── env
        ├── log
        │   ├── access.log
        │   └── error.log
        └── myproject
            ├── manage.py
            ├── myproject
            │   ├── __init__.py
            │   ├── settings.py
            │   ├── urls.py
            │   └── wsgi.py
            └── static
</code></pre>
<h3><a class="header" href="#1-패키지-설치" id="1-패키지-설치">1. 패키지 설치</a></h3>
<pre><code class="language-bash">$ sudo apt-get install python3-dev python3-pip python3-venv nginx 
$ sudo apt-get install postgresql postgresql-contrib libpq-dev # postgresql 관련 패키지
</code></pre>
<h3><a class="header" href="#2-가상환경-설정" id="2-가상환경-설정">2. 가상환경 설정</a></h3>
<p>먼저 프로젝트들은 <code>~/projects</code> 폴더를 만들어서 관리할 것이다. 프로젝트 이름이 <code>myproject</code>라고 한다면</p>
<pre><code class="language-bash">$ mkdir projects &amp;&amp; cd projects
$ mkdir myproject &amp;&amp; cd myproject # 프로젝트 폴더 생성
$ python3 -m venv env # 가상환경 생성
$ source env/bin/activate # 가상환경 활성화
(env) $
</code></pre>
<h3><a class="header" href="#3-nginx-설정" id="3-nginx-설정">3. nginx 설정</a></h3>
<p>Django 프로젝트를 설정하기 전에 nginx 관련 설정을 먼저 하자.</p>
<pre><code class="language-bash">(env) $ mkdir log config
(env) $ cd log
(env) $ touch access.log error.log
(env) $ cd ..
(env) $ cd config
(env) $ vim myproject_nginx.conf
</code></pre>
<h6><a class="header" href="#projectsmyprojectconfigmyproject_nginxconf" id="projectsmyprojectconfigmyproject_nginxconf">~/projects/myproject/config/myproject_nginx.conf</a></h6>
<pre><code class="language-bash">server {
        # the port your site will be served on
        listen 80;
 
        # the domain name it will serve for
        server_name     example.io; # 여기에 도메인 주소를 적는다
        charset         utf-8;
 
        access_log      /home/my-user/projects/myproject/log/access.log;
        error_log       /home/my-user/projects/myproject/log/error.log;
 
        location /static/ { # STATIC_URL
            alias /home/my-user/projects/myproject/myproject/static/; # STATIC_ROOT
            expires 30d;
        }

        location / {
            include proxy_params;
            proxy_pass http://unix:/home/my-user/projects/myproject/config/myproject.sock;
        }
}
</code></pre>
<p>이제 이 파일을 nginx 경로에 추가한다.</p>
<pre><code class="language-bash">(env) $ sudo ln -s ~/projects/myproject/config/myproject_nginx.conf /etc/nginx/sites-enabled/
</code></pre>
<p>그리고 nginx 설정 파일의 문법을 검사하고 서비스를 시작한다.</p>
<pre><code class="language-bash">(env) $ sudo nginx -t
(env) $ sudo systemctl start nginx
(env) $ sudo ufw allow 8000 # Django의 runserver 기능을 위해 8000번 포트도 열어준다.
</code></pre>
<h3><a class="header" href="#3-데이터베이스-설정" id="3-데이터베이스-설정">3. 데이터베이스 설정</a></h3>
<p>Django 프로젝트에서 postgresql을 사용한다면 다음과 같은 설정을 거쳐야 한다.</p>
<pre><code class="language-bash">(env) $ sudo -u postgres psql
postgres=# CREATE DATABASE myproject; # 데이터베이스 생성
postgres=# CREATE USER myprojectuser with PASSWORD 'password'; # 유저 생성
postgres=# GRANT ALL PRIVILEGES ON DATABASE myproject TO myprojectuser; # 권한 할당
postgres=# \q
</code></pre>
<h3><a class="header" href="#4-프로젝트-생성" id="4-프로젝트-생성">4. 프로젝트 생성</a></h3>
<p>실제 프로젝트는 git clone을 통해 가져왔지만 편의상 프로젝트를 새로 생성하는 것으로 글을 쓰겠다.</p>
<pre><code class="language-bash">(env) $ pip install --upgrade pip
(env) $ pip install django gunicorn psycopg2 whitenoise
(env) $ django-admin startproject myproject
(env) $ cd myproject
(env) $ vim myproject/settings.py
</code></pre>
<h6><a class="header" href="#myprojectsettingspy" id="myprojectsettingspy">myproject/settings.py</a></h6>
<pre><code class="language-python">...
ALLOWED_HOSTS = ['my_domain_name']
...
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'myproject',
        'USER': 'myprojectuser',
        'PASSWORD': 'password',
        'HOST': 'localhost',
        'PORT': '',
    }
}
...
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static/')
</code></pre>
<h6><a class="header" href="#myprojectwsgipy" id="myprojectwsgipy">myproject/wsgi.py</a></h6>
<pre><code class="language-python">from whitenoise.django import DjangoWhiteNoise
...
application = DjangoWhiteNoise(get_wsgi_application())
...
</code></pre>
<h4><a class="header" href="#프로젝트-실행" id="프로젝트-실행">프로젝트 실행</a></h4>
<pre><code class="language-bash">(env) $ python manage.py makemigrations
(env) $ python manage.py migrate
(env) $ python manage.py collectstatic
(env) $ python manage.py runserver 0.0.0.0:8000
</code></pre>
<p>http://my_domain_name:8000/ 으로 접속하여 내용이 잘 출력되는지 확인한다.</p>
<h3><a class="header" href="#5-gunicorn-설정" id="5-gunicorn-설정">5. Gunicorn 설정</a></h3>
<pre><code class="language-bash">(env) $ gunicorn --bind 0.0.0.0:8000 myproject.wsgi:application
</code></pre>
<p>Gunicorn을 통해 서버를 구동한다. 마찬가지로 http://my_domain_name:8000/ 으로 접속하여 내용이 잘 출력되는지 확인한다. 잘 동작한다면 <code>deactivate</code>로 가상환경을 종료하자.</p>
<p>그리고 Gunicorn의 서비스 스크립트를 만든다.</p>
<h6><a class="header" href="#projectsmyprojectconfiggunicornservice" id="projectsmyprojectconfiggunicornservice">~/projects/myproject/config/gunicorn.service</a></h6>
<pre><code class="language-bash">[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=my-user
Group=www-data
WorkingDirectory=/home/my-user/projects/myproject/myproject
ExecStart=/home/my-user/projects/myproject/env/bin/gunicorn \
        --workers 3 \
        --bind unix:/home/my-user/projects/myproject/config/myproject.sock \
        myproject.wsgi:application

[Install]
WantedBy=multi-user.target
</code></pre>
<p>이제 이 파일을 서비스에 추가하고 서비스를 실행시킨다.</p>
<pre><code class="language-bash">$ sudo ln -s ~/projects/myproject/config/gunicorn.service /etc/systemd/system/
$ sudo systemctl daemon-reload
$ sudo systemctl start gunicorn
$ sudo systemctl enable gunicorn
$ sudo systemctl status gunicorn
</code></pre>
<p>마지막으로 방화벽을 설정한다.</p>
<pre><code class="language-bash">$ sudo ufw delete 8000
$ sudo ufw allow 'Nginx Full'
</code></pre>
<p>http://my_domain_name/ 으로 접속하여 내용이 잘 출력되는지 확인한다.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="http://www.maxchung.com/2015/11/06/domain-%EA%B5%AC%EC%9E%85%EA%B8%B0-%EB%B0%8F-conoha%EC%97%90-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B8%B0/">maxchung님의 블로그</a>를 참고했다.
<sup class="footnote-reference"><a href="#2">2</a></sup>: <a href="http://www.haruair.com/blog/2220">haruair님의 블로그</a>를 참고했다.
<sup class="footnote-reference"><a href="#3">3</a></sup>: <a href="https://blog.chann.kr/initial-server-setup-with-ubuntu-14-04/">chann님의 블로그</a>를 참고했다.
<sup class="footnote-reference"><a href="#4">4</a></sup>: <a href="https://blog.qwaz.io/dev-diary/%EC%84%9C%EB%B2%84-%EC%84%B8%ED%8C%85%ED%95%98%EA%B8%B0-1%EB%B6%80">quaz님의 블로그</a>와 <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-16-04">DigitalOcean</a>을 참고했다.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../django/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../django/django-bluebook.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../django/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../django/django-bluebook.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
