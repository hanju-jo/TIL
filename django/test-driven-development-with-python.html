<!DOCTYPE HTML>
<html lang="ko" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Test Driven Development With Python - Hanju's TIL Book</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">README</a></li><li class="chapter-item "><a href="../data-visualization/index.html"><strong aria-hidden="true">1.</strong> Data Visualization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../data-visualization/d3.js-tutorial.html"><strong aria-hidden="true">1.1.</strong> D3.js Tutorial</a></li></ol></li><li class="chapter-item "><a href="../database/index.html"><strong aria-hidden="true">2.</strong> Database</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../database/mongodb-setup.html"><strong aria-hidden="true">2.1.</strong> Mongodb Setup</a></li><li class="chapter-item "><a href="../database/postgresql-on-ubuntu.html"><strong aria-hidden="true">2.2.</strong> Postgresql On Ubuntu</a></li></ol></li><li class="chapter-item "><a href="../design-patterns/index.html"><strong aria-hidden="true">3.</strong> Design Patterns</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../design-patterns/abstract-factory.html"><strong aria-hidden="true">3.1.</strong> Abstract Factory</a></li><li class="chapter-item "><a href="../design-patterns/adapter.html"><strong aria-hidden="true">3.2.</strong> Adapter</a></li><li class="chapter-item "><a href="../design-patterns/decorator.html"><strong aria-hidden="true">3.3.</strong> Decorator</a></li><li class="chapter-item "><a href="../design-patterns/delegation.html"><strong aria-hidden="true">3.4.</strong> Delegation</a></li><li class="chapter-item "><a href="../design-patterns/factory.html"><strong aria-hidden="true">3.5.</strong> Factory</a></li></ol></li><li class="chapter-item expanded "><a href="../django/index.html"><strong aria-hidden="true">4.</strong> Django</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../django/deploying-django-project-on-ubuntu-using-nginx-and-gunicorn.html"><strong aria-hidden="true">4.1.</strong> Deploying Django Project On Ubuntu Using Nginx And Gunicorn</a></li><li class="chapter-item "><a href="../django/django-bluebook.html"><strong aria-hidden="true">4.2.</strong> Django Bluebook</a></li><li class="chapter-item "><a href="../django/django-setup.html"><strong aria-hidden="true">4.3.</strong> Django Setup</a></li><li class="chapter-item "><a href="../django/django-with-postgresql-on-aws-ec2.html"><strong aria-hidden="true">4.4.</strong> Django With Postgresql On Aws Ec2</a></li><li class="chapter-item expanded "><a href="../django/test-driven-development-with-python.html" class="active"><strong aria-hidden="true">4.5.</strong> Test Driven Development With Python</a></li></ol></li><li class="chapter-item "><a href="../docker/index.html"><strong aria-hidden="true">5.</strong> Docker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../docker/about-docker.html"><strong aria-hidden="true">5.1.</strong> About Docker</a></li><li class="chapter-item "><a href="../docker/docker-cheatsheet.html"><strong aria-hidden="true">5.2.</strong> Docker Cheatsheet</a></li><li class="chapter-item "><a href="../docker/docker-for-jekyll.html"><strong aria-hidden="true">5.3.</strong> Docker For Jekyll</a></li><li class="chapter-item "><a href="../docker/gollum-via-docker.html"><strong aria-hidden="true">5.4.</strong> Gollum Via Docker</a></li></ol></li><li class="chapter-item "><a href="../english/index.html"><strong aria-hidden="true">6.</strong> English</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../english/newly-learned-words-or-phrases.html"><strong aria-hidden="true">6.1.</strong> Newly Learned Words Or Phrases</a></li></ol></li><li class="chapter-item "><a href="../git/index.html"><strong aria-hidden="true">7.</strong> Git</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../git/git-cheat-sheet.html"><strong aria-hidden="true">7.1.</strong> Git Cheat Sheet</a></li><li class="chapter-item "><a href="../git/steps-after-fork.html"><strong aria-hidden="true">7.2.</strong> Steps After Fork</a></li></ol></li><li class="chapter-item "><a href="../jekyll/index.html"><strong aria-hidden="true">8.</strong> Jekyll</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../jekyll/add-disqus-to-jekyll.html"><strong aria-hidden="true">8.1.</strong> Add Disqus To Jekyll</a></li><li class="chapter-item "><a href="../jekyll/jekyll-with-google-analytics.html"><strong aria-hidden="true">8.2.</strong> Jekyll With Google Analytics</a></li></ol></li><li class="chapter-item "><a href="../ml/index.html"><strong aria-hidden="true">9.</strong> Ml</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ml/ml-study-notes.html"><strong aria-hidden="true">9.1.</strong> Ml Study Notes</a></li></ol></li><li class="chapter-item "><a href="../python/index.html"><strong aria-hidden="true">10.</strong> Python</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../python/effective-python.html"><strong aria-hidden="true">10.1.</strong> Effective Python</a></li><li class="chapter-item "><a href="../python/fundamental-python.html"><strong aria-hidden="true">10.2.</strong> Fundamental Python</a></li><li class="chapter-item "><a href="../python/python-react-setup.html"><strong aria-hidden="true">10.3.</strong> Python React Setup</a></li><li class="chapter-item "><a href="../python/python-tips.html"><strong aria-hidden="true">10.4.</strong> Python Tips</a></li><li class="chapter-item "><a href="../python/python-virtualenv.html"><strong aria-hidden="true">10.5.</strong> Python Virtualenv</a></li><li class="chapter-item "><a href="../python/transforming-code-into-beautiful-idiomatic-python.html"><strong aria-hidden="true">10.6.</strong> Transforming Code Into Beautiful Idiomatic Python</a></li></ol></li><li class="chapter-item "><a href="../reactjs/index.html"><strong aria-hidden="true">11.</strong> Reactjs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reactjs/reactjs-setup.html"><strong aria-hidden="true">11.1.</strong> Reactjs Setup</a></li></ol></li><li class="chapter-item "><a href="../sicp/index.html"><strong aria-hidden="true">12.</strong> Sicp</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sicp/1_02.html"><strong aria-hidden="true">12.1.</strong> 1_02</a></li><li class="chapter-item "><a href="../sicp/1_03.html"><strong aria-hidden="true">12.2.</strong> 1_03</a></li><li class="chapter-item "><a href="../sicp/1_05.html"><strong aria-hidden="true">12.3.</strong> 1_05</a></li><li class="chapter-item "><a href="../sicp/1_06.html"><strong aria-hidden="true">12.4.</strong> 1_06</a></li><li class="chapter-item "><a href="../sicp/1_07.html"><strong aria-hidden="true">12.5.</strong> 1_07</a></li><li class="chapter-item "><a href="../sicp/1_08.html"><strong aria-hidden="true">12.6.</strong> 1_08</a></li><li class="chapter-item "><a href="../sicp/1_09.html"><strong aria-hidden="true">12.7.</strong> 1_09</a></li><li class="chapter-item "><a href="../sicp/1_10.html"><strong aria-hidden="true">12.8.</strong> 1_10</a></li><li class="chapter-item "><a href="../sicp/racket.html"><strong aria-hidden="true">12.9.</strong> Racket</a></li></ol></li><li class="chapter-item "><a href="../snippets/index.html"><strong aria-hidden="true">13.</strong> Snippets</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../snippets/c++.html"><strong aria-hidden="true">13.1.</strong> C++</a></li></ol></li><li class="chapter-item "><a href="../uncategorized/index.html"><strong aria-hidden="true">14.</strong> Uncategorized</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../uncategorized/dotfiles.html"><strong aria-hidden="true">14.1.</strong> Dotfiles</a></li><li class="chapter-item "><a href="../uncategorized/hmac.html"><strong aria-hidden="true">14.2.</strong> Hmac</a></li><li class="chapter-item "><a href="../uncategorized/unix-command-tips.html"><strong aria-hidden="true">14.3.</strong> Unix Command Tips</a></li></ol></li><li class="chapter-item "><a href="../vim/index.html"><strong aria-hidden="true">15.</strong> Vim</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../vim/plugin-manager-vim-plug.html"><strong aria-hidden="true">15.1.</strong> Plugin Manager Vim Plug</a></li><li class="chapter-item "><a href="../vim/plugin-manager-vundle.html"><strong aria-hidden="true">15.2.</strong> Plugin Manager Vundle</a></li><li class="chapter-item "><a href="../vim/plugin-youcompleteme.html"><strong aria-hidden="true">15.3.</strong> Plugin Youcompleteme</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Hanju's TIL Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/hanju-jo/TIL" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#클린-코드를-위한-테스트-주도-개발" id="클린-코드를-위한-테스트-주도-개발">클린 코드를 위한 테스트 주도 개발</a></h1>
<blockquote>
<p>원서 소개 링크 http://www.obeythetestinggoat.com</p>
</blockquote>
<h4><a class="header" href="#실행-환경" id="실행-환경">실행 환경</a></h4>
<ul>
<li>macOS 10.12.3</li>
<li>python 3.5.2</li>
<li>selenium 3.3.1</li>
<li>firefox 52.0</li>
</ul>
<h3><a class="header" href="#p-5" id="p-5">p. 5</a></h3>
<h4><a class="header" href="#problem" id="problem">Problem</a></h4>
<p>첫 번째 테스트부터 책에 나온대로 되지 않는다.</p>
<h6><a class="header" href="#소스코드" id="소스코드">소스코드</a></h6>
<pre><code class="language-python">from selenium import webdriver

browser = webdriver.Firefox()
browser.get('http://localhost:8000')

assert 'Django' in browser.title
</code></pre>
<p>코드를 돌려보니 원하는 에러 메시지가 아니다. 아무래도 <code>geckodriver</code>를 가지고 해결해야 하는 듯 하다.</p>
<h4><a class="header" href="#how-to-solve" id="how-to-solve">How to solve</a></h4>
<h5><a class="header" href="#1-on-mac-os" id="1-on-mac-os">1. on Mac OS</a></h5>
<p>먼저 <a href="https://github.com/mozilla/geckodriver/releases/tag/v0.15.0">geckodriver</a>를 설치하고 적당한 위치에 넣어주자. 나는 최신 릴리즈 버전인 0.15.0을 설치했다. 그리고 아래 사항들을 진행한다.</p>
<pre><code class="language-bash"># 파일을 열어 다음을 추가한다. 폴더의 경로는 자신의 것에 맞게 수정한다.
$ vim ~/.bash_profile
export PATH=$PATH:/YOUR/DIRECTORY/PATH/geckodriver-v0.15.0-macos

# 변경사항을 쉘에 적용한다.
$ source ~/.bash_profile

# 변경이 잘 되었는지 확인한다.
$ geckodriver --version
geckodriver 0.15.0

The source code of this program is available at
https://github.com/mozilla/geckodriver.

This program is subject to the terms of the Mozilla Public License 2.0.
You can obtain a copy of the license at https://mozilla.org/MPL/2.0/.
</code></pre>
<p>이번에는 <code>http://localhost:8000</code> 를 접속하는 데서 에러가 난다. 이를 무시하고 책을 계속 따라가다보면, Django 테스트에서 이 코드가 사용되기 때문에 그다지 문제가 없다. 그러나 만약 <code>geckodriver</code> 문제가 잘 해결되었는지 확인하고 싶다면, <code>http://localhost:8000</code> 대신 <code>http://www.google.com</code>와 같은 실재하는 주소를 넣어보자. 그러면 원하는 <code>AssertionError</code> 를 얻을 수 있을 것이다.</p>
<pre><code class="language-bash">$ python functional_test.py
Traceback (most recent call last):
  File &quot;functional_test.py&quot;, line 6, in &lt;module&gt;
    assert 'Django' in browser.title
AssertionError
</code></pre>
<h4><a class="header" href="#2-on-ubuntu" id="2-on-ubuntu">2. on Ubuntu</a></h4>
<pre><code class="language-bash">$ wget https://github.com/mozilla/geckodriver/releases/download/v0.15.0/geckodriver-v0.15.0-linux64.tar.gz # install
$ tar -xvzf geckodriver-v0.15.0-linux64.tar.gz geckodriver # unpack
$ rm geckodriver-v0.15.0-linux64.tar.gz # delete tar file
$ chmod +x geckodriver
$ export PATH=$PATH:/YOUR/DIRECTORY/PATH/geckodriver
</code></pre>
<h3><a class="header" href="#p33" id="p33">p.33</a></h3>
<h4><a class="header" href="#problem-1" id="problem-1">Problem</a></h4>
<p><code>python manage.py runserver</code>를 실행하면 다음과 같은 에러메시지가 나온다.</p>
<pre><code class="language-bash">Error: view must be a callable or a list/tuple in the case of include().
</code></pre>
<h4><a class="header" href="#how-to-solve-1" id="how-to-solve-1">How to solve</a></h4>
<h6><a class="header" href="#superlistsurlspy" id="superlistsurlspy">superlists/urls.py</a></h6>
<pre><code class="language-python">from django.conf.urls import url
from lists import views

urlpatterns = [
    url(r'^$', views.home_page, name='home')
]
</code></pre>
<h3><a class="header" href="#p63" id="p63">p.63</a></h3>
<h4><a class="header" href="#how-to-solve-2" id="how-to-solve-2">How to solve</a></h4>
<p>csrf_token을 제거하고 비교하도록 한다.</p>
<h6><a class="header" href="#liststestpy" id="liststestpy">lists/test.py</a></h6>
<pre><code class="language-python">class HomePageTest(TestCase):

    def remove_csrf(self, origin):
        csrf_regex = r'&lt;input[^&gt;]+csrfmiddlewaretoken[^&gt;]+&gt;'
        return re.sub(csrf_regex, '', origin)

    def test_root_url_resolves_to_home_page_view(self):
        found = resolve('/')
        self.assertEqual(found.func, home_page)

    def test_home_page_returns_correct_html(self):
        request = HttpRequest()
        response = home_page(request)
        expected_html = self.remove_csrf(render_to_string('home.html'))
        response_decode = self.remove_csrf(response.content.decode())

        self.assertEqual(response_decode, expected_html)

    def test_home_page_can_save_a_post_request(self):
        request = HttpRequest()
        request.method = 'POST'
        request.POST['item_text'] = 'A new item'

        response = home_page(request)

        self.assertIn('A new item', response.content.decode())

        expected_html = self.remove_csrf(render_to_string(
            'home.html',
            {'new_item_text': 'A new item'}
        ))
        response_decode = self.remove_csrf(response.content.decode())

        self.assertEqual(response_decode, expected_html)
</code></pre>
<h3><a class="header" href="#p85" id="p85">p.85</a></h3>
<h4><a class="header" href="#problem-2" id="problem-2">Problem</a></h4>
<p>페이지 마지막의 기능 테스트를 성공하면 다음과 같은 메시지가 떠야한다.</p>
<pre><code class="language-bash">Traceback (most recent call last):
  File &quot;functional_test.py&quot;, line 77, in test_can_start_a_list_and_retrieve_it_later
    self.fail('Finish the test!')
AssertionError: Finish the test!
</code></pre>
<p>그러나 다음과 같은 에러 메시지가 떴다.</p>
<pre><code class="language-bash">selenium.common.exceptions.InvalidSelectorException: Message: Given css selector expression &quot;tr&quot; is invalid: TypeError: can't access dead object
</code></pre>
<h4><a class="header" href="#how-to-solve-3" id="how-to-solve-3">How to solve</a></h4>
<p>이 문제에 대해서 <a href="http://stackoverflow.com/a/41206683">stackoverflow</a>에 저자가 답변을 달아놨는데, 책에서는 Selenium2을 사용했는데 Selenium3으로 업데이트 되면서 <code>implicit wait</code>을 처리하는 방법이 달라졌기 때문에 에러가 난다고 한다. 다음과 같이 코드를 수정해주자.</p>
<h6><a class="header" href="#functional_testpy" id="functional_testpy">functional_test.py</a></h6>
<pre><code class="language-python">...
from contextlib import contextmanager
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support.expected_conditions import staleness_of

class NewVisitorTest(unittest.TestCase):
    ...
    @contextmanager
    def wait_for_page_load(self, timeout=30):
        old_page = self.browser.find_element_by_tag_name(&quot;html&quot;)
        yield WebDriverWait(self.browser, timeout).until(
            staleness_of(old_page)
        )
    ...
    def test_can_start_list_and_retrieve_it_later(self):
        ...
        inputbox.send_keys(&quot;Buy peacock feathers&quot;)
        inputbox.send_keys(Keys.ENTER)

        with self.wait_for_page_load(timeout=10):
            self.check_for_row_in_list_table(&quot;1: Buy peacock feathers&quot;)

        inputbox = self.browser.find_element_by_id(&quot;id_new_item&quot;)
        inputbox.send_keys(&quot;Use peacock feathers to make a fly&quot;)
        inputbox.send_keys(Keys.ENTER)

        with self.wait_for_page_load(timeout=10):
            self.check_for_row_in_list_table(&quot;1: Buy peacock feathers&quot;)
            self.check_for_row_in_list_table(&quot;2: Use peacock feathers to make a fly&quot;)
</code></pre>
<h3><a class="header" href="#p95" id="p95">p.95</a></h3>
<h4><a class="header" href="#yagni" id="yagni">YAGNI</a></h4>
<blockquote>
<p>설계에 대해 한번 생각하기 시작하면 생각을 멈추는 것이 쉽지 않다. 여러 가지 생각이 떠오르기 시작한다. [중략] 하지만 애자일 복음인 <strong>YAGNI</strong>에 순종해야 한다(야그니라 읽는다). &quot;You ain't gonna need it.&quot;(그것을 사용할 일이 없을 것이다)의 약자다. 소프트웨어 개발자로서 우리는 무언가 만드는 것을 즐긴다. 또한 아이디어가 생각나서 그것을 직접 구축해보고 싶어서 안달이 나는 경우도 있을 것이다. 하지만 아이디어가 정말 끝내주더라도 대개는 그걸 사용하지 않고 끝나는 경우가 많다 오히려 사용하지 않는 코드로 가득 차서 애플리케이션이 복잡해지기도 한다. YAGNI는 창의적이지만 과도한 열정을 억제해주는 경전이라고 할 수 있다.</p>
</blockquote>
<h3><a class="header" href="#p101" id="p101">p.101</a></h3>
<h4><a class="header" href="#problem-3" id="problem-3">Problem</a></h4>
<p>p.97에서 다음과 같이 기능 테스트를 수정했다. <code>self.wait_for_page_load</code> 부분은 이 포스트의 윗부분(p.85)에 수정했던 부분이다.</p>
<h6><a class="header" href="#functional_teststestspy" id="functional_teststestspy">functional_tests/tests.py</a></h6>
<pre><code class="language-python"># When she hits enter, the page updates, and now the page lists
# &quot;1: Buy peacock feathers&quot; as an item in a to-do list
inputbox.send_keys(Keys.ENTER)
edith_list_url = self.browser.current_url
self.assertRegex(edith_list_url, '/lists/.+')
with self.wait_for_page_load(timeout=10):
    self.check_for_row_in_list_table(&quot;1: Buy peacock feathers&quot;)
</code></pre>
<p>p.100에서 home_page 뷰를 수정했는데도, 기능 테스트를 실행하면 이전에 나왔던 에러 메시지가 똑같이 나온다.</p>
<pre><code class="language-bash">self.assertRegex(edith_list_url, '/lists/.+')
AssertionError: Regex didn't match: '/lists/.+' not found in 'http://localhost:8081/'
</code></pre>
<h4><a class="header" href="#how-to-solve-4" id="how-to-solve-4">How to solve</a></h4>
<h6><a class="header" href="#functional_teststestspy-1" id="functional_teststestspy-1">functional_tests/tests.py</a></h6>
<pre><code class="language-python"># When she hits enter, the page updates, and now the page lists
# &quot;1: Buy peacock feathers&quot; as an item in a to-do list
inputbox.send_keys(Keys.ENTER)
with self.wait_for_page_load(timeout=10):
    self.check_for_row_in_list_table(&quot;1: Buy peacock feathers&quot;)
edith_list_url = self.browser.current_url
self.assertRegex(edith_list_url, '/lists/.+')
</code></pre>
<p>기존의 코드에서 순서를 조금 바꿨는데, 엔터를 입력받은 후에 암묵적인 대기 시간(implicit wait)을 주도록 수정했다. 이제 다시 기능 테스트를 실행하면 원하는 메시지를 얻을 수 있다.</p>
<pre><code class="language-bash">selenium.common.exceptions.NoSuchElementException: Message: Unable to locate element: [id=&quot;id_list_table&quot;]
</code></pre>
<h3><a class="header" href="#p103" id="p103">p.103</a></h3>
<h4><a class="header" href="#how-to-solve-5" id="how-to-solve-5">How to solve</a></h4>
<pre><code class="language-python">from django.conf.urls import url
from lists import views

urlpatterns = [
    url(r'^$', views.home_page, name='home'),
    url(
        r'^lists/the-only-list-in-the-world/$',
        views.view_list,
        name='view_list')
]
</code></pre>
<h3><a class="header" href="#p104" id="p104">p.104</a></h3>
<h4><a class="header" href="#problem-4" id="problem-4">Problem</a></h4>
<p>책에서는 다음과 같은 에러가 나길 원한다.</p>
<pre><code>AssertionError: '2: Use peacock feathers to make a fly' not found in ['1: Buy peacock feathers']
</code></pre>
<p>그런데 다음과 같은 에러가 나는 것은 implicit wait를 설정해주었기 때문이고, 자세히 살펴보면 같은 곳에서 에러가 나는 것이므로 문제될 것이 없다.</p>
<pre><code class="language-bash">	raise TimeoutException(message, screen, stacktrace)
selenium.common.exceptions.TimeoutException: Message:
</code></pre>
<h3><a class="header" href="#p107" id="p107">p.107</a></h3>
<p>원하지 않는 에러가 나타났다. 기능 테스트 과정에서 브라우저를 껐다가 다시 켰는데도 이전의 쿠키가 남아있는 모양이다.</p>
<pre><code class="language-bash">	self.assertIn(row_text, [row.text for row in rows])
AssertionError: '1: Buy milk' not found in ['1: Buy peacock feathers', '2: Use peacock feathers to make a fly', '3: Buy milk']
</code></pre>
<h3><a class="header" href="#p171" id="p171">p.171</a></h3>
<h4><a class="header" href="#problem-5" id="problem-5">Problem</a></h4>
<pre><code class="language-bash">AttributeError: type object 'NewVisitorTest' has no attribute 'server_thread'
</code></pre>
<h4><a class="header" href="#how-to-solve-6" id="how-to-solve-6">How to Solve</a></h4>
<p>tearDownClass가 다음과 같은 에러를 만들어내서 주석처리 해주었다.</p>
<pre><code class="language-python">class NewVisitorTest(StaticLiveServerTestCase):
    
    @classmethod
    def setUpClass(cls):
        for arg in sys.argv:
            if 'liveserver' in arg:
                cls.server_url = 'http://' + arg.split('=')[1]
                return
        super().setUpClass()
        cls.server_url = cls.live_server_url

    # @classmethod
    # def tearDownClass(cls):
    #     if cls.server_url == cls.live_server_url:
    #         super().tearDownClass()
</code></pre>
<h3><a class="header" href="#p177" id="p177">p.177</a></h3>
<p>이제 Ubuntu에서 upstart 를 사용하지 않는다고 한다.<sup class="footnote-reference"><a href="#4">1</a></sup> 대신 service 를 사용했다.</p>
<h6><a class="header" href="#nginxconf" id="nginxconf">nginx.conf</a></h6>
<pre><code class="language-bash">server {
    listen 80;
    server_name tdd.aweek-jo.com;

    location /static {
        alias /home/modo/projects/tdd.aweek-jo.com/static;
    }

    location / {
        proxy_set_header Host $host;
        proxy_pass http://unix:/home/modo/projects/tdd.aweek-jo.com/gunicorn.sock;
    }
}
</code></pre>
<h6><a class="header" href="#gunicornservice" id="gunicornservice">gunicorn.service</a></h6>
<pre><code class="language-bash">[Unit]
Description=Gunicorn daemon
After=network.target

[Service]
User=modo
Group=www-data
WorkingDirectory=/home/modo/projects/tdd.aweek-jo.com/source
ExecStart=/home/modo/projects/tdd.aweek-jo.com/env/bin/gunicorn \
        --workers 3 \
        --bind unix:/home/modo/projects/tdd.aweek-jo.com/gunicorn.sock \
        superlists.wsgi:application

[Install]
WantedBy=multi-user.target
</code></pre>
<pre><code class="language-bash">$ sudo ln -s ~/Path/to/yourfile/gunicorn.service /etc/systemd/system/
$ sudo systemctl daemon-reload
$ sudo systemctl start gunicorn
$ sudo systemctl enable gunicorn
$ sudo systemctl status gunicorn
</code></pre>
<h5><a class="header" href="#refer-to" id="refer-to">Refer to</a></h5>
<ul>
<li>
<p><a href="http://www.obeythetestinggoat.com">원서 소개 링크</a></p>
</li>
<li>
<p><a href="https://hyesun03.github.io/2016/09/19/djangoTDD01/">hyesun03님의 블로그: 클린 코드를 위한 테스트 주도 개발</a></p>
</li>
<div class="footnote-definition" id="4"><sup class="footnote-definition-label">1</sup>
<p><a href="http://askubuntu.com/a/621209">참고 링크</a></p>
</div>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../django/django-with-postgresql-on-aws-ec2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../docker/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../django/django-with-postgresql-on-aws-ec2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../docker/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
